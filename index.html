<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Startup Carbon Reduction Calculator</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Startup Carbon Reduction Calculator</h1>
            <p>Quantify the net carbon reduction contribution of discount retail for near-expiry/surplus goods (Unit: Tonnes CO‚ÇÇe/Year)</p>
            
            <!-- Import/Export Control -->
            <div style="margin-top: 15px; padding: 10px; background: #eef2f7; border-radius: 8px; display: inline-block;">
                <strong>üìÇ Data Management: </strong>
                <input type="file" id="import-file" accept=".json" style="display: none;">
                <button class="secondary-btn" onclick="document.getElementById('import-file').click()">üìÇ Import JSON</button>
                <!-- NEW: Export Button -->
                <button class="secondary-btn" onclick="exportDataToJson()">üíæ Export JSON</button>
                <button class="secondary-btn" onclick="downloadSampleJson()">‚¨áÔ∏è Download Sample Format</button>
            </div>
        </header>

        <!-- Configuration Section (New) -->
        <section class="input-section config-section">
            <details>
                <summary>‚öôÔ∏è Global Parameters & Product Categories (Click to Expand)</summary>
                
                <div class="config-grid">
                    <!-- Transport Emission Factors -->
                    <div class="config-group">
                        <h3>Transport Emission Factors (kg CO‚ÇÇe/kg/km)</h3>
                        <div class="input-grid">
                            <label>Road (Weighted): <input type="number" id="factor-road" step="0.00001" value="0.0002"></label>
                            <label>Rail: <input type="number" id="factor-rail" step="0.00001" value="0.00001"></label>
                            <label>Ship: <input type="number" id="factor-ship" step="0.00001" value="0.00005"></label>
                            <label>Air: <input type="number" id="factor-air" step="0.00001" value="0.00075"></label>
                            <label>Consumer Transport (per km): <input type="number" id="factor-consumer" step="0.001" value="0.002"></label>
                            <label>Storage (per kg/month): <input type="number" id="factor-storage" step="0.01" value="0.05"></label>
                        </div>
                    </div>

                    <!-- Product Category Settings -->
                    <div class="config-group full-width">
                        <h3>Product Categories</h3>
                        <div id="category-container">
                            <!-- Categories will be generated by JS -->
                        </div>
                        <button class="secondary-btn" onclick="addCategory()">+ Add Category</button>
                    </div>
                </div>
            </details>
        </section>

        <!-- Year Input -->
        <section class="input-section">
            <h2>üìÖ Timeline Settings</h2>
            <div class="year-inputs">
                <label>Start Year: <input type="number" id="start-year" value="2025" min="2000"></label>
                <label>Number of Years: <input type="number" id="num-years" value="1" min="1" max="20"></label>
                <button id="generate-years">Reset Timeline</button>
                <!-- NEW: Manual Toggle Button -->
                <button id="manual-toggle-btn" class="secondary-btn" style="margin-top:0; margin-left:10px;" onclick="toggleInputsManual()">üîº Hide Inputs</button>
            </div>
            <!-- Added New Button for Scenario Simulation -->
            <div style="margin-top: 10px; padding-top: 10px; border-top: 1px dashed #ddd;">
                <button id="load-scenario-btn" class="secondary-btn" style="background:#8e44ad; width:auto;">
                    ‚ú® Load 10-Year Growth Scenario (Demo)
                </button>
            </div>
        </section>

        <!-- NEW: Edit Control Bar (Shown after calculation) -->
        <div id="edit-control-bar" class="edit-control-bar" onclick="toggleInputs(true)">
            üìù Inputs are hidden for better view. Click here to Edit Data.
        </div>

        <!-- Yearly Data Container -->
        <div id="years-container"></div>

        <!-- Calculate Button -->
        <button id="calculate-btn">üöÄ Calculate Output</button>
    </div>

    <!-- Results Section -->
    <!-- Added existing container class to align with top -->
    <div class="container">
        <section class="result-section" id="results" style="display: none;">
            <h2>üìà Calculation Results</h2>
            
            <!-- Single Year Results -->
            <div id="single-year-results" style="display: none;">
                <div class="metrics-cards">
                    <div class="card"><h3>Avoided Emissions</h3><p id="avoided-emission">--</p></div>
                    <div class="card"><h3>Additional Emissions</h3><p id="additional-emission">--</p></div>
                    <div class="card"><h3>Net Reduction</h3><p id="net-reduction">--</p></div>
                </div>
                <div class="charts">
                    <div class="chart-container">
                        <h3>Net Reduction Breakdown</h3>
                        <canvas id="emission-bar-chart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Additional Emission Distribution</h3>
                        <canvas id="additional-pie-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Multi Year Results -->
            <div id="multi-year-results" style="display: none;">
                <div class="charts">
                    <!-- Existing Charts -->
                    <div class="chart-container">
                        <h3>Net Reduction Over Time</h3>
                        <canvas id="net-reduction-line"></canvas>
                    </div>
                    <!-- NEW: Dynamic Stack Chart -->
                    <div class="chart-container" id="impact-stack-container">
                        <h3>üèóÔ∏è Annual Reduction Accumulation</h3>
                        <p style="text-align:center; font-size:0.8em; color:#666; margin-bottom:10px;">Dynamic visualization of saved carbon piling up over years</p>
                        <!-- Animation Container -->
                        <div id="impact-stack-vis" class="stack-vis-wrapper">
                            <!-- Chips will be inserted here by JS -->
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <h3>Cumulative Reduction</h3>
                        <canvas id="cumulative-area"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Cumulative Sold Volume (Tonnes)</h3>
                        <canvas id="cumulative-sales-chart"></canvas>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="default_data.js"></script> 
    <script src="calculator.js"></script>
    <script src="visualization.js"></script>
</body>
</html>